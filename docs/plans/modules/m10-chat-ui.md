# M10: å¯¹è¯ç•Œé¢

> ä¾èµ–ï¼šM4, M6 | äº§å‡ºï¼šæ¶ˆæ¯æµ + è¾“å…¥æ¡† + @ å¼•ç”¨äº¤äº’

## ç›®æ ‡

å®ç°å¯¹è¯ä¸­å¿ƒåŒºåŸŸçš„æ ¸å¿ƒäº¤äº’ï¼šæ¶ˆæ¯æµå±•ç¤ºã€ç”¨æˆ·è¾“å…¥ã€@ å¼•ç”¨é€‰æ‹©ã€‚

## ç»„ä»¶æ¸…å•

### `src/components/chat/chat-area.tsx` â€” å¯¹è¯åŒºåŸŸå®¹å™¨

ä¸­å¤®åŒºåŸŸçš„ä¸»ç»„ä»¶ï¼ŒåŒ…å«ï¼š
- æ¶ˆæ¯æµï¼ˆæ»šåŠ¨åŒºåŸŸï¼‰
- è¾“å…¥åŒºåŸŸï¼ˆåº•éƒ¨å›ºå®šï¼‰

### `src/components/chat/message-list.tsx` â€” æ¶ˆæ¯æµ

- æŒ‰æ—¶é—´é¡ºåºå±•ç¤ºæ¶ˆæ¯
- ç”¨æˆ·æ¶ˆæ¯é å³ï¼ŒAgent æ¶ˆæ¯é å·¦
- æ”¯æŒ Markdown æ¸²æŸ“
- è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
- Agent å›å¤æ—¶æ˜¾ç¤ºæµå¼æ‰“å­—æ•ˆæœ

### `src/components/chat/message-bubble.tsx` â€” å•æ¡æ¶ˆæ¯æ°”æ³¡

- ç”¨æˆ·æ¶ˆæ¯ï¼šæ˜¾ç¤ºæ–‡æœ¬ + @ å¼•ç”¨æ ‡ç­¾
- Agent æ¶ˆæ¯ï¼šæ˜¾ç¤ºæ–‡æœ¬ + å¯èƒ½åŒ…å«ç‰¹æ®Šç»„ä»¶ï¼ˆè§„åˆ’å¡ç‰‡ã€é¢„è§ˆå¡ç‰‡ã€Diff å¡ç‰‡ï¼‰
- æ—¶é—´æˆ³

### `src/components/chat/chat-input.tsx` â€” è¾“å…¥æ¡†

æ ¸å¿ƒäº¤äº’ç»„ä»¶ï¼š
- å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡†ï¼ˆè‡ªåŠ¨æ‰©å±•é«˜åº¦ï¼‰
- `@` è§¦å‘å¼•ç”¨é€‰æ‹©
- å·²é€‰å¼•ç”¨ä»¥æ ‡ç­¾å½¢å¼æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¸Šæ–¹
- å‘é€æŒ‰é’®ï¼ˆEnter å‘é€ï¼ŒShift+Enter æ¢è¡Œï¼‰

### `src/components/chat/mention-popover.tsx` â€” @ å¼•ç”¨å¼¹å‡ºåˆ—è¡¨

è¾“å…¥ `@` æ—¶å¼¹å‡ºçš„é€‰æ‹©é¢æ¿ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” æœç´¢...            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ Prompt             â”‚
â”‚   æ¬¢è¿è¯­ prompt       â”‚
â”‚   å›å¤æ¨¡æ¿ prompt      â”‚
â”‚   é—®é¢˜åˆ†ç±» prompt      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ çŸ¥è¯†åº“              â”‚
â”‚   äº§å“æ‰‹å†Œ.pdf         â”‚
â”‚   FAQ æ–‡æ¡£.md          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‚ å…¶ä»–é¡¹ç›®ï¼ˆåªè¯»ï¼‰     â”‚
â”‚   [é¡¹ç›®B] å®¢æœ prompt  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ç‰¹æ€§ï¼š
- åˆ†ç»„å±•ç¤ºï¼ˆå½“å‰é¡¹ç›® Promptã€çŸ¥è¯†åº“ã€å…¶ä»–é¡¹ç›®ï¼‰
- æœç´¢è¿‡æ»¤
- é”®ç›˜ä¸Šä¸‹é€‰æ‹© + Enter ç¡®è®¤
- æ”¯æŒè¿ç»­å¤šæ¬¡ @ é€‰æ‹©å¤šä¸ªå¼•ç”¨

### `src/components/chat/reference-tag.tsx` â€” å¼•ç”¨æ ‡ç­¾

å·²é€‰å¼•ç”¨åœ¨è¾“å…¥æ¡†ä¸Šæ–¹çš„æ˜¾ç¤ºï¼š
- Prompt å¼•ç”¨ï¼šè“è‰²æ ‡ç­¾ `ğŸ“‹ æ¬¢è¿è¯­ prompt Ã—`
- æ–‡æ¡£å¼•ç”¨ï¼šç»¿è‰²æ ‡ç­¾ `ğŸ“ äº§å“æ‰‹å†Œ.pdf Ã—`
- ç‚¹å‡» Ã— ç§»é™¤

### `src/components/chat/session-list.tsx` â€” ä¼šè¯åˆ—è¡¨

å·¦ä¾§æ ä¸­çš„ä¼šè¯åˆ—è¡¨ï¼ˆä¹Ÿæ”¾åœ¨ chat ç›®å½•ä¸‹ï¼‰ï¼š
- æ˜¾ç¤ºå½“å‰é¡¹ç›®çš„æ‰€æœ‰ä¼šè¯
- æ¯é¡¹æ˜¾ç¤ºï¼šæ ‡é¢˜ + æœ€åæ´»è·ƒæ—¶é—´
- ç‚¹å‡»åˆ‡æ¢ä¼šè¯
- æ–°å»ºä¼šè¯æŒ‰é’®
- åˆ é™¤ä¼šè¯ï¼ˆç¡®è®¤å¼¹çª—ï¼‰

## SSE æµå¼æ¥æ”¶

### `src/lib/utils/sse-client.ts` â€” SSE å®¢æˆ·ç«¯

```typescript
export async function* streamChat(request: ChatRequest): AsyncGenerator<StreamEvent>
```

- ä½¿ç”¨ `fetch` + `ReadableStream` æ¥æ”¶ SSE
- è§£æäº‹ä»¶ç±»å‹ï¼ˆtext / plan / preview / diff / done / errorï¼‰
- ä¾› chat-area ç»„ä»¶æ¶ˆè´¹

## çŠ¶æ€ç®¡ç†

### `src/lib/store/chat-context.tsx`

```typescript
interface ChatState {
  messages: Message[]
  isStreaming: boolean
  currentReferences: MessageReference[]
}
```

## æäº¤

```bash
git add src/components/chat/ src/lib/utils/sse-client.ts src/lib/store/chat-context.tsx
git commit -m "feat: add chat interface with message flow, input and @ mentions"
```
