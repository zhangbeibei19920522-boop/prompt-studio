# M12: å¯¹è¯ç‰¹æ®Šç»„ä»¶

> ä¾èµ–ï¼šM10, M11 | äº§å‡ºï¼šè§„åˆ’å¡ç‰‡ã€é¢„è§ˆå¡ç‰‡ã€Diff å¡ç‰‡

## ç›®æ ‡

å®ç°å¯¹è¯æµä¸­çš„ä¸‰ç§ç‰¹æ®Šäº¤äº’ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶åµŒå…¥åœ¨ Agent çš„æ¶ˆæ¯ä¸­ï¼Œç”¨æˆ·é€šè¿‡å®ƒä»¬ç¡®è®¤æˆ–æ‹’ç» Agent çš„æ“ä½œã€‚

## ç»„ä»¶æ¸…å•

### `src/components/chat/plan-card.tsx` â€” è§„åˆ’å¡ç‰‡

Agent è§„åˆ’å®Œæˆåï¼Œåœ¨å¯¹è¯ä¸­å±•ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ä¿®æ”¹è§„åˆ’                          â”‚
â”‚                                     â”‚
â”‚ æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘æ‹†åˆ†ä¸ºä»¥ä¸‹å…³é”®ç‚¹ï¼š       â”‚
â”‚                                     â”‚
â”‚ âœ… 1. ä¿®æ”¹ã€Œæ¬¢è¿è¯­ promptã€            â”‚
â”‚    â†’ å¢åŠ å¤šè¯­è¨€æ”¯æŒé€»è¾‘                â”‚
â”‚ âœ… 2. æ–°å»ºã€Œè¯­è¨€æ£€æµ‹ promptã€           â”‚
â”‚    â†’ è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·è¯­è¨€                  â”‚
â”‚                                     â”‚
â”‚         [ç¡®è®¤æ‰§è¡Œ]  [ä¿®æ”¹è§„åˆ’]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Props:
- `plan: AgentPlan` â€” è§„åˆ’æ•°æ®
- `onConfirm: () => void` â€” ç”¨æˆ·ç¡®è®¤æ‰§è¡Œ
- `onModify: (feedback: string) => void` â€” ç”¨æˆ·è¦æ±‚ä¿®æ”¹è§„åˆ’

è¡Œä¸ºï¼š
- æ¯ä¸ªå…³é”®ç‚¹å¯ä»¥å•ç‹¬å‹¾é€‰/å–æ¶ˆ
- "ç¡®è®¤æ‰§è¡Œ"å‘é€ç¡®è®¤æ¶ˆæ¯ç»™ Agent
- "ä¿®æ”¹è§„åˆ’"å¼¹å‡ºè¾“å…¥æ¡†è®©ç”¨æˆ·å¡«å†™ä¿®æ”¹æ„è§

### `src/components/chat/preview-card.tsx` â€” Prompt é¢„è§ˆå¡ç‰‡

Agent æ–°å»º prompt æ—¶å±•ç¤ºå®Œæ•´å†…å®¹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ¨ æ–°å»º Promptï¼šè¯­è¨€æ£€æµ‹ prompt        â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ prompt å†…å®¹ï¼ˆMarkdown æ¸²æŸ“ï¼‰     â”‚ â”‚
â”‚ â”‚ æ”¯æŒæŠ˜å å±•å¼€                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚   [åº”ç”¨ä¿å­˜]  [åœ¨å³ä¾§ç¼–è¾‘]  [æ‹’ç»]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Props:
- `data: PreviewData` â€” åŒ…å« title, content, description
- `onApply: () => void` â€” ç›´æ¥ä¿å­˜
- `onEdit: () => void` â€” åœ¨å³ä¾§é¢æ¿æ‰“å¼€ç¼–è¾‘å™¨
- `onReject: (reason: string) => void` â€” æ‹’ç»å¹¶è¯´æ˜åŸå› 

è¡Œä¸ºï¼š
- å†…å®¹åŒºåŸŸå¯æŠ˜å ï¼ˆé»˜è®¤å±•å¼€å‰ 20 è¡Œï¼‰
- "åœ¨å³ä¾§ç¼–è¾‘"æ‰“å¼€å³ä¾§é¢æ¿çš„ç¼–è¾‘å™¨ï¼Œç¼–è¾‘å®Œæˆåä¿å­˜
- "æ‹’ç»"å¼¹å‡ºè¾“å…¥æ¡†è®©ç”¨æˆ·è¯´æ˜åŸå› ï¼Œè§¦å‘ Agent é‡æ–°ç”Ÿæˆ

### `src/components/chat/diff-card.tsx` â€” Diff å¯¹æ¯”å¡ç‰‡

Agent ä¿®æ”¹å·²æœ‰ prompt æ—¶å±•ç¤ºå˜æ›´ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœï¸ ä¿®æ”¹ Promptï¼šæ¬¢è¿è¯­ prompt         â”‚
â”‚                                     â”‚
â”‚ @@ -3,5 +3,5 @@                     â”‚
â”‚  ä½ æ˜¯ä¸€ä¸ªå®¢æœåŠ©æ‰‹                     â”‚
â”‚ -è¯·ç”¨ä¸­æ–‡å›å¤ç”¨æˆ·                     â”‚
â”‚ +è¯·ç”¨{{è¯­è¨€}}å›å¤ç”¨æˆ·                 â”‚
â”‚  ä¿æŒå‹å¥½å’Œä¸“ä¸š                       â”‚
â”‚                                     â”‚
â”‚   [åº”ç”¨ä¿®æ”¹]  [åœ¨å³ä¾§ç¼–è¾‘]  [æ‹’ç»]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Props:
- `data: DiffData` â€” åŒ…å« promptId, title, oldContent, newContent, diff
- `onApply: () => void` â€” åº”ç”¨ä¿®æ”¹
- `onEdit: () => void` â€” åœ¨å³ä¾§é¢æ¿æ‰“å¼€ç¼–è¾‘å™¨ï¼ˆæ˜¾ç¤ºä¿®æ”¹åçš„ç‰ˆæœ¬ï¼‰
- `onReject: (reason: string) => void` â€” æ‹’ç»

Diff è®¡ç®—ï¼š
- ä½¿ç”¨ `diff` åº“è®¡ç®—è¡Œçº§å·®å¼‚
- çº¢è‰²ï¼ˆ-ï¼‰è¡¨ç¤ºåˆ é™¤è¡Œï¼Œç»¿è‰²ï¼ˆ+ï¼‰è¡¨ç¤ºæ–°å¢è¡Œ
- ç°è‰²ä¸ºæœªå˜æ›´çš„ä¸Šä¸‹æ–‡è¡Œ

### `src/components/chat/card-actions.tsx` â€” å¡ç‰‡æ“ä½œæ 

ä¸‰ç§å¡ç‰‡å…±ç”¨çš„æ“ä½œæŒ‰é’®æ ç»„ä»¶ã€‚

## ç±»å‹è¡¥å……

åœ¨ `src/types/ai.ts` ä¸­è¡¥å……ï¼š

```typescript
export interface PreviewData {
  title: string
  content: string
  description: string
  tags: string[]
  variables: PromptVariable[]
}

export interface DiffData {
  promptId: string
  title: string
  oldContent: string
  newContent: string
}

export interface PlanData {
  keyPoints: PlanKeyPoint[]
  status: 'pending' | 'confirmed' | 'rejected'
}
```

## äº¤äº’æµç¨‹

```
Agent è¾“å‡ºè§„åˆ’ â†’ è§„åˆ’å¡ç‰‡
  â”œâ”€â”€ ç”¨æˆ·ç¡®è®¤ â†’ Agent æ‰§è¡Œ â†’ é¢„è§ˆ/Diff å¡ç‰‡
  â”‚     â”œâ”€â”€ ç”¨æˆ·åº”ç”¨ â†’ ä¿å­˜ prompt â†’ å®Œæˆ
  â”‚     â”œâ”€â”€ ç”¨æˆ·ç¼–è¾‘ â†’ å³ä¾§é¢æ¿ç¼–è¾‘ â†’ ä¿å­˜
  â”‚     â””â”€â”€ ç”¨æˆ·æ‹’ç» â†’ Agent æ ¹æ®åé¦ˆé‡æ–°ç”Ÿæˆ
  â””â”€â”€ ç”¨æˆ·ä¿®æ”¹è§„åˆ’ â†’ Agent é‡æ–°è§„åˆ’ â†’ æ–°çš„è§„åˆ’å¡ç‰‡
```

## æäº¤

```bash
git add src/components/chat/plan-card.tsx src/components/chat/preview-card.tsx src/components/chat/diff-card.tsx
git commit -m "feat: add plan card, preview card and diff card for agent interaction"
```
